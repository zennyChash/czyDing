<?xml version="1.0" encoding="UTF-8"?>
<dataSource>
	<src id="dzjk_maxnyr" name="最大有效日期" description="" sourceType ="sql">
		<sql>
		<![CDATA[
			select max(ny||ri)nyr from YSSR_HZTJ
		]]>
		</sql>
		<cols>
			<col name="nyr" canOrder="1"/>
		</cols>
	</src>
	<src id="dzjk_year" name="有数据的年份" description="" sourceType ="sql">
		<sql>
		<![CDATA[
			select distinct substr(ny,1,4)nian from YSSR_HZTJ
		]]>
		</sql>
		<cols>
			<col name="nian" canOrder="1"/>
		</cols>
	</src>
	<src id="dzjk_month" name="有数据的月份" description="" sourceType ="sql">
		<sql>
		<![CDATA[
			select distinct substr(ny,1,4)nian,substr(ny,5,2)yue,ny from YSSR_HZTJ
		]]>
		</sql>
		<cols>
			<col name="nian" isFilter="1"/>
			<col name="yue" isFilter="1"/>
			<col name="ny" canOrder="1"/>
		</cols>
	</src>
	<src id="dzjk_day" name="有数据的日期" description="" sourceType ="sql">
		<sql>
		<![CDATA[
			select distinct ny,ri from YSSR_HZTJ
		]]>
		</sql>
		<cols>
			<col name="ny" isFilter="1"/>
			<col name="ri" isFilter="1"/>
			<col name="nyr" canOrder="1"/>
		</cols>
	</src>
	<src id="dzjk_srjd" name="收入进度信息" description="" sourceType ="sql">
		<sql>
		<![CDATA[
			select zwrq_jk zwrq,nlj_jk nlj_jk_o,round(nlj_jk/10000,2)nlj_jk,round(nlj_jk/jhs*100) wcjd from(
				select ny||ri zwrq_jk,sum(nlj_jk) nlj_jk,jhs from yssr_hztj r,yssr_tb t 
				where substr(ny,1,4)=nian group by ny||ri,jhs)
		]]>
		</sql>
		<cols>
			<col name="zwrq" canOrder="1" isFilter="1"/>
			<col name="nlj_jk_o" fldType="double" />
			<col name="nlj_jk" fldType="double" />
			<col name="wcjd" fldType="double" />
		</cols>
	</src>
	<src id="dzjk_srzb_jg" name="机构收入占比信息" description="" sourceType ="sql">
		<sql>
		<![CDATA[
			select zwrq_jk zwrq,jgdm_jk,jg,round(nlj_jk/10000,2) nlj,round(nlj_jk/sum(nlj_jk) over (partition by zwrq_jk)*100) zb,
			r.color chartcolor,decode(jgdm_jk,'222222222222',1,0)selected
			from( select ny||ri zwrq_jk,sum(nlj_jk) nlj_jk,jgdm_jk,jg
				from yssr_hztj group by jgdm_jk,jg,ny||ri
			)a,renders r where r.rptid='dzjk_srzb_jg' and r.lid = a.jgdm_jk order by zwrq_jk,jgdm_jk
		]]>
		</sql>
		<cols>
			<col name="zwrq" canOrder="1" isFilter="1"/>
			<col name="nlj" fldType="double"/>
			<col name="selected" fldType="integer"/>
			<col name="zb" fldType="double"/>
		</cols>
	</src>
	<src id="dzjk_by_years" name="分年度税收对比" description="" sourceType ="sql">
		<sql>
		<![CDATA[
			SELECT to_number(substr(ny,1,4))nian,to_number(substr(ny,5,2))dyue,
			sum(nlj_jk) nlj_o,round(sum(nlj_jk)/10000,2)nlj FROM yssr_hztj
			group by ny order by ny
		]]>
		</sql>
		<cols>
			<col name="nian" fldType="integer" canOrder="1" isFilter="1"/>
			<col name="dyue" fldType="integer" canOrder="1"/>
			<col name="nlj_o" fldType="double"/>
			<col name="nlj" fldType="double"/>
		</cols>
	</src>
	<src id="dzjk_fsz" name="分税种详情" description="" sourceType ="sql">
		<sql>
		<![CDATA[
			select zwrq_jk zwrq,szbm,sz,bnlj bnlj_o,round(bnlj/10000,2)bnlj,sntq sntq_o,round(sntq/10000,2)sntq,tbzz,
			round(bnlj/sum(bnlj) over (partition by zwrq_jk)*100,2) srzb from (
				select zwrq_jk,szbm,sz,sum(bnlj) bnlj,sum(sntq) sntq,
				case when sum(sntq)=0 then 0 else  round((sum(bnlj)-sum(sntq))/sum(sntq)*100,1) end tbzz
				from (
					SELECT ny||ri zwrq_jk,szbm,sz,sum(nlj_jk) bnlj,0 sntq FROM yssr_hztj
					where szbm in ('10101','10104','10106') group by szbm,sz,ny||ri union
					SELECT ny||ri zwrq_jk,'90000' szbm,'其他税' sz,sum(nlj_jk) bnlj,0 sntq FROM  yssr_hztj
					where szbm not in ('10101','10104','10106') group by ny||ri union
					SELECT to_char(i.zwrq_jk),szbm,sz,0 bnlj,sum(nlj_jk) sntq FROM yssr_hztj y,yssr_index i
					where y.ny||y.ri=i.zwrq_tq and  szbm in ('10101','10104','10106') group by szbm,sz,i.zwrq_jk union
					SELECT to_char(i.zwrq_jk),'90000' szbm,'其他税' sz,0 bnlj,sum(nlj_jk) sntq FROM yssr_hztj y,yssr_index i
					where y.ny||y.ri=i.zwrq_tq and szbm not in ('10101','10104','10106') group by i.zwrq_jk
				)
			group by zwrq_jk,szbm,sz)order by zwrq_jk,szbm
		]]>
		</sql>
		<cols>
			<col name="zwrq" canOrder="1" isFilter="1"/>
			<col name="szbm" canOrder="1" />
			<col name="bnlj" fldType="double"/>
			<col name="sntq" fldType="double"/>
			<col name="bnlj_o" fldType="double"/>
			<col name="sntq_o" fldType="double"/>
			<col name="tbzz" fldType="double"/>
			<col name="srzb" fldType="double"/>
		</cols>
	</src>
	
</dataSource>